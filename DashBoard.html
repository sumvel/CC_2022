<!DOCTYPE html>
<html lang="en">

<head>
    <title>Cricket Carnival</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="stylesheet" href="./default.css">
    <link rel="stylesheet" href="./w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="./data.js"></script>
    <script src="./other_functions.js"></script>
    <script src="./data_processing.js"></script>
</head>

<body class="w3-light-grey">

    <!-- Top container -->
    <div class="w3-bar w3-top slb-blue w3-large" style="z-index:4">
        <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>&nbsp;Menu</button>
        <span class="w3-bar-item w3-left">IPL 2022</span>
        <span class="w3-bar-item w3-right">Cricket Carnival 2022</span>
    </div>
    <!-- Sidebar/menu -->
    <nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="z-index:3;width:300px;" id="mySidebar"><br>
        <div class="w3-container w3-row">
            <div class="w3-col s4">
                <img src="./avatar2.png" class="w3-circle w3-margin-right" style="width:46px">
            </div>
            <div class="w3-col s8 w3-bar">
                <span><strong>Welcome</strong></span><br>
                <!-- <a href="#" class="w3-bar-item w3-button"><i class="fa fa-envelope"></i></a>
                <a href="#" class="w3-bar-item w3-button"><i class="fa fa-user"></i></a>
                <a href="#" class="w3-bar-item w3-button"><i class="fa fa-cog"></i></a> -->
            </div>
        </div>
        <hr>
        <div class="w3-container">
            <h5>Dashboard</h5>
        </div>
        <div class="w3-bar-block">
            <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>&nbsp;Close Menu</a>
            <a href="#" class="w3-bar-item w3-button w3-padding w3-blue"><i class="fa fa-users fa-fw"></i>&nbsp;Overview</a>
            <a href="main.html" class="w3-bar-item w3-button w3-padding" target="_new"><i class="fa fa fa-line-chart fa-fw"></i>&nbsp;Score Card</a>
            <a href="fame.html" class="w3-bar-item w3-button w3-padding"><i class="fa fa-street-view fa-fw"></i>&nbsp;Hall of fame</a>
            <a href="rules.html" class="w3-bar-item w3-button w3-padding"><i class="fa fa-book fa-fw"></i>&nbsp;Rules</a>
            <a href="about.html" class="w3-bar-item w3-button w3-padding"><i class="fa fa-sitemap fa-fw"></i>&nbsp;Team</a><br><br>
            <a href="https://forms.office.com/r/gSLtniXE93" class="w3-bar-item w3-button w3-yellow w3-padding" target="_new" title='Click here to select your team for Round-5.'>
                <!-- "https://apps.powerapps.com/play/154d667e-93da-4e31-9874-1b597a4b00ad?tenantId=41ff26dc-250f-4b13-8981-739be8610c21&skipAppMetadata=true&hidenavbar=true" -->
                <div class="w3-text-pink w3-hover-text-deep-purple w3-center" style="font-size: 4rem;">
                    <strong>Click here to select for Round5</strong>
                </div>
            </a>

            <!-- <a href="#" class="w3-bar-item w3-button w3-yellow w3-padding">
                <div class="w3-text-cyan w3-hover-text-deep-blue w3-center" style="font-size: 2rem;">
                    <strong>The trick is to never lose hope!</strong>
                </div>
            </a> -->
        </div>
    </nav>

    <!-- Overlay effect when opening sidebar on small screens -->
    <div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

    <!-- !PAGE CONTENT! -->
    <div class="w3-main" style="margin-left:300px;margin-top:43px;">

        <!-- Header -->
        <header class="w3-container" style="padding-top:22px">
            <div class="img-container">
                <img class="w3-image" src="./stadium_wide.png" alt="London" style="width:100%;min-height:200px;max-height:300px;">
                <div class="centered-left">
                    <div id="img_centered_teamA"><img src="csk.png"></div>
                </div>
                <div class="centered">
                    <strong>#</strong><strong id="img_centered_text">CRICKET CARNIVAL</strong>
                </div>
                <div class="centered-right">
                    <div id="img_centered_teamB"><img src="kkr.png"></div>
                </div>
            </div>
            <h5><b><i class="fa fa-dashboard"></i> Dashboard</b></h5>
        </header>

        <!--Temp Notice-->
        <!--div class="w3-container w3-red w3-text-white">
            <h3>ROUND-4 entries being updated... Thanks for your patience</h3>
        </div>
        <br-->
        <div class="w3-row-padding">
            <!-- Individual top ranking -->
            <div class="w3-quarter">
                <h5>Individual Rankings as of ( <span id="cur_date1"></span> )</h5>
            </div>
            <div class="w3-quarter">
                <h5>Group Rankings</h5>
            </div>
            <!-- Rankings and Support count -->
            <div class="w3-quarter">
                <h5>Support Breakdown</h5>
            </div>
            <!-- Team A bar chart -->
            <div class="w3-quarter" id="choose_round"></div>
        </div>

        <!-- First Team Row -->
        <div class="w3-row-padding w3-margin-bottom">
            <!-- Individual ranking -->
            <div class="w3-quarter" id="top_player_ranks_group">
                <!-- <div class="w3-quarter" id="top_player_ranks" style="width:100%;max-width:500px;height:450px;overflow:auto;"></div>                 -->
            </div>

            <!-- Team ranking -->
            <div class="w3-quarter">
                <div class="w3-quarter" id="top_team_ranks" style="width:100%;max-width:500px;"></div>
            </div>

            <!-- Rankings and Support count -->
            <div class="w3-quarter">
                <!-- <div class="w3-margin-bottom" id="choose_round"></div> -->
                <div class="w3-half">
                    <div class="w3-container ipl-csk w3-padding" id="choose_teamA_container">
                        <div class="w3-left"><i class="fa fa-users w3-xxxlarge"></i></div>
                        <div class="w3-right" id="choose_teamA_count">0</div>
                        <div class="w3-clear"></div>
                        <div id="choose_teamA">TEAM A</div>
                    </div>
                </div>
                <div class="w3-half">
                    <div class="w3-container ipl-kkr w3-padding" id="choose_teamB_container">
                        <div class="w3-left"><i class="fa fa-users w3-xxxlarge"></i></div>
                        <div class="w3-right" id="choose_teamB_count">0</div>
                        <div class="w3-clear"></div>
                        <div id="choose_teamB">TEAM B</div>
                    </div>
                </div>
                <div id="choose_pie_chart" style="width:100%;max-width:500px;overflow: auto;"></div>
            </div>

            <!-- Team A bar chart -->
            <div class="w3-quarter">
                <!-- <div id="myPlot_Pie_1" style="width:100%;max-width:500px;"></div> -->
                <div id="myPlot_bar_1" style="width:100%;max-width:500px;"></div>
            </div>
        </div>
        
        <!-- Second Team Row -->
        <div class="w3-row-padding w3-margin-bottom">
            <!-- Pie chart -->
            <div class="w3-half">
                <div id="myPlot_Donut_1" style="width:100%;max-width:500px"></div>
            </div>
            <!-- Team A bar chart -->
            <div class="w3-quarter">
                <div id="myPlot_hor_bar_1" style="width:100%;max-width:500px"></div>
            </div>
            <!-- Team B bar chart -->
            <div class="w3-quarter">
                <div id="myPlot_hor_bar_2" style="width:100%;max-width:500px"></div>
            </div>
        </div>
        
        <!--Disclaimer-->
        <div class="w3-container w3-padding-5 w3-dark-gray w3-tiny w3-text-light-gray">
            <p>*Abbreviations - Elec: "Electrical Department", RP: "Reservoir Performance", WEC: "Well Construction", WPRS: "Well Production Systems", Rest of STSI: ("Modelling & Simulations" + "TechCom" + "A2 & Cross Segment Team" + "Others")</p>
        </div>
        <!-- Detailed Score Card -->
        <div class="w3-panel w3-margin-bottom">
            <div class="w3-row-padding" style="margin:0 -16px">                
                <div class="w3-theme-d2">
                    <h5>Score Card</h5>
                    <iframe src="main.html" title="MainBoard" style="width:100%;height:600px;border: 0;"></iframe>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="w3-container w3-padding-5 w3-dark-grey w3-center">
            <p>The best way to predict the future is to create it</p>
        </footer>
        <div class="w3-container w3-padding-5 w3-grey w3-tiny w3-text-light-gray">
            <p>**Site best viewed in 1280 x 1024 or higher screen resolution.</p>
        </div>
    </div>
    <!-- !END OF PAGE CONTENT! -->

    <script>
        var mySidebar = document.getElementById("mySidebar");
        var overlayBg = document.getElementById("myOverlay");
        // Toggle between showing and hiding the sidebar, and add overlay effect
        function w3_open() {
            if (mySidebar.style.display === 'block') {
                mySidebar.style.display = 'none';
                overlayBg.style.display = "none";
            } else {
                mySidebar.style.display = 'block';
                overlayBg.style.display = "block";
            }
        }

        // Close the sidebar with the close button
        function w3_close() {
            mySidebar.style.display = "none";
            overlayBg.style.display = "none";
        }

        // var steam_st = new Array("WPRS", "WEC", "Elec", "RP", "RoS");
        // var teams_list_st = new Array("CSK", "DC", "GT", "KKR", "LSG", "MI", "PBKS", "RCB", "RR", "SRH");

        var TR1_teams = steam_short; // ["Electrical", "RP", "WEC", "WPRS", "Rest of STSI"];
        var TR2_teams = steam_short; // not yet released
        var TR3_teams = steam_short; // not yet released
        var TR4_teams = steam_short; // not yet released
        
        var TR1_count = [30, 27, 33, 35, 28] // Manually update for first round;
        var TR2_count = [30, 16, 26, 21, 31]; //not yet released
        var TR3_count = [16, 23, 17, 23, 19]; //not yet released
        var TR4_count = [15, 23, 14, 18, 9]; //not yet released

        var IPLcolorsObj = {CSK:"#FFFF3C", DC:"#00008B", GT:"#4752a1", KKR:"#2E0854", LSG:"#7fd2d8", MI:"#004BA0", PBKS:"#DCDDDF", RCB:"#EC1C24", RR:"#CBA92B", SRH:"#FF822A"};
        var IPLcolorsArr = ["#FFFF3C", "#00008B", "#4752a1", "#2E0854", "#7fd2d8", "#004BA0", "#DCDDDF", "#EC1C24", "#CBA92B", "#FF822A"];
        var IPLcolorClss = ["ipl-csk", "ipl-dc", "ipl-gt", "ipl-kkr", "ipl-lsg", "ipl-mi", "ipl-pbks", "ipl-rcb", "ipl-rr", "ipl-srh"];

        // var xArray = [24, 18, 12, 12, 6, 23, 3, 7];
        // var yArray = ["Electrical", "RP", "WEC", "WPRS", "Rest of STSI"];
        function showPieChart(xArray, yArray, ID, chartTile, chartLegend, chartHeight, chartColors /* array eg. [red, blue]*/) {
            if (!chartLegend || chartLegend == null) {chartLegend = false;}
            var data = [{
                labels:xArray,
                values:yArray,
                // hole: .4,
                type:"pie",
                textinfo: "label+percent",
                insidetextorientation: "radial",
                marker: {
                    colors: chartColors
                },
                automargin: true
            }];

            var layout = {
                title:chartTile,
                showlegend: chartLegend,
                height: chartHeight,
                margin: {"t": 50, "b": 20, "l": 1, "r": 1}
            };

            Plotly.newPlot(ID, data, layout);
        }

        function showDonutPieChart(ID, chartTile, chartLegend, val1, lbl1, val2, lbl2, txt1, txt2) {
            var data = [{
                values: val1,
                labels: lbl1,
                textposition: 'inside',
                domain: {column: 0},
                hoverinfo: 'label+percent+name',
                hole: .4,
                type: 'pie',
                textinfo: "label+percent",
                insidetextorientation: "radial",
                automargin: true
                },{
                values: val2,
                labels: lbl2,
                textposition: 'inside',
                domain: {column: 1},
                hoverinfo: 'label+percent+name',
                hole: .4,
                type: 'pie',
                textinfo: "label+percent",
                insidetextorientation: "radial",
                automargin: true
            }];

            var layout = {
                title: 'Team Participation',
                annotations: [{
                        font: {size: 20},
                        showarrow: false,
                        text: txt1,
                        x: 0.2,
                        y: 0.5
                    },
                    {
                        font: {size: 20},
                        showarrow: false,
                        text: txt2,
                        x: 0.80,
                        y: 0.5
                    }],
                height: 190,
                showlegend: chartLegend,
                grid: {rows: 1, columns: 2},
                margin: {"t": 30, "b": 5, "l": 0, "r": 0}

            };

            Plotly.newPlot(ID, data, layout);
        }

        function showVerDblBarChart(x1, y1, x2, y2, ID, chartTile, chartLegend, trace1Color, trace2Color, name1, name2) {
            var trace1 = {
            x: ["Elec", "RP", "WEC", "WPRS", "RoS"],
            y: y1,
            type: 'bar',
            name: name1,
            marker: {
                color: trace1Color,
                opacity: 0.7
            }
            };

            var trace2 = {
            x: ["Elec", "RP", "WEC", "WPRS", "RoS"],
            y: y2,
            type: 'bar',
            name: name2,
            marker: {
                color: trace2Color,
                opacity: 0.8
            }
            };

            var data = [trace1, trace2];

            var layout = {
            title: chartTile,
            xaxis: {
                tickangle: -45
            },
            showlegend: chartLegend,
            barmode: 'group'
            };

            Plotly.newPlot(ID, data, layout);
        }

        function showHorBarChart(xArray, yArray, ID, chartTile, barColor) {
            if (!xArray || xArray == null) {xArray = TR1_count;}
            if (!yArray || yArray == null) {yArray = TR1_teams;}
            if (!chartTile) {chartTile="undefined";}
            if (!barColor) {barColor="rgba(255,0,0,0.6)";}
            var data = [{
                x:xArray,
                y:yArray,
                type:"bar",
                orientation:"h",
                marker: {color:barColor}
            }];
            var layout = {
                title:chartTile
            };

            Plotly.newPlot(ID, data, layout);
        }

        function showVerBarChart(xArray, yArray, ID, chartTile, barColor) {
            if (!xArray || xArray == null) {xArray = TR1_teams;}
            if (!yArray || yArray == null) {yArray = TR1_count;}
            if (!chartTile) {chartTile="undefined";}
            if (!barColor) {barColor="rgba(255,0,0,0.6)";}
            var data = [{
                x:xArray,
                y:yArray,
                type:"bar",
                marker: {color:barColor}
            }];
            var layout = {
                title:chartTile
            };

            Plotly.newPlot(ID, data, layout);
        }

        function calcTeamSupport() {
            var mat1 = [];
            for (let i = 0; i < picks.length; i++) {
                const e = picks[i].pick;
                mat1[i] = e[i];
                console.log(i + " : " + e[0]);
            }
            console.log(mat1);
        }

        function update_match_info(){
            /*===========================*\
                Home Default values
            \*===========================*/
            var matid = document.getElementById("choose_match_id");
            if (matid.options[matid.selectedIndex].value == "default") {
                p = match_result.length;
                if (p >= matches)
                    p = matches - 1;
            } else {
                var matnum = matid.options[matid.selectedIndex].value;
                p = parseInt(matnum) - 1;
            }

            document.getElementById("choose_teamA").innerHTML = teams_list_st[teams_list_st.indexOf(team1[p])];
            document.getElementById("choose_teamB").innerHTML = teams_list_st[teams_list_st.indexOf(team2[p])];

            document.getElementById("choose_teamA_count").innerHTML = team1_bets[p];
            document.getElementById("choose_teamB_count").innerHTML = team2_bets[p];

            document.getElementById("img_centered_teamA").innerHTML = "<img src='" + team1[p].toLowerCase() + ".png'>";
            document.getElementById("img_centered_teamB").innerHTML = "<img src='" + team2[p].toLowerCase() + ".png'>";
            
            document.getElementById("choose_teamA_container").className = "w3-container w3-padding-16 " + IPLcolorClss[teams_list_st.indexOf(team1[p])];
            document.getElementById("choose_teamB_container").className = "w3-container w3-padding-16 " + IPLcolorClss[teams_list_st.indexOf(team2[p])];

            if (Number(team1_bets[p]) > Number(team2_bets[p])) {
                document.getElementById("img_centered_text").setAttribute("style", "color:" + IPLcolorsArr[teams_list_st.indexOf(team1[p])] + ";");
            } else {
                document.getElementById("img_centered_text").setAttribute("style", "color:" + IPLcolorsArr[teams_list_st.indexOf(team2[p])] + ";");
            }

            showPieChart([teams_list_st[teams_list_st.indexOf(team1[p])], teams_list_st[teams_list_st.indexOf(team2[p])]], [team1_bets[p], team2_bets[p]], "choose_pie_chart", "Support", false, 347.5, [IPLcolorsArr[teams_list_st.indexOf(team1[p])], IPLcolorsArr[teams_list_st.indexOf(team2[p])]]);
            // showPieChart(TR1_teams, TR1_count, "myPlot_Pie_1", "Participation Round: 1", false, 450);
            
            showVerDblBarChart(null, team1_steam_supp[p].steam, null, team2_steam_supp[p].steam, "myPlot_bar_1", "Group Supports", false, IPLcolorsArr[teams_list_st.indexOf(team1[p])], IPLcolorsArr[teams_list_st.indexOf(team2[p])], team1[p], team2[p]);
            showDonutPieChart("tr_pie_1", "Participation Rate - Round 1 and 2", false, TR1_count, TR1_teams, TR2_count, TR2_teams, "R1", "R2");
            showDonutPieChart("tr_pie_2", "Participation Rate - Round 3 and 4", false, TR3_count, TR3_teams, TR4_count, TR4_teams, "R3", "R4");


            // showHorBarChart([17, 8, 12, 12, 6], null, "myPlot_hor_bar_1", "Group Supports for " + team1[p], IPLcolorsArr[teams_list_st.indexOf(team1[p])]);
            // showHorBarChart([18, 25, 18, 15, 22], null, "myPlot_hor_bar_2", "Group Supports for " + team2[p], IPLcolorsArr[teams_list_st.indexOf(team2[p])]);

            // showVerBarChart(null, [17, 8, 12, 12, 6, 18, 2, 7], "myPlot_hor_bar_1", "Team Entries for CSK", "rgba(255,0,0,0.6)");
            // showVerBarChart(null, [7, 2, 2, 5, 0, 5, 1, 0], "myPlot_hor_bar_2", "Team Entries for KKR", "rgba(0, 102, 255, 0.6)");
            console.log(team1_steam_supp[p].steam);
            console.log(team2_steam_supp[p].steam);

            const d = new Date();
            let date = d.getDate() + '-' + (d.getMonth()+1) + '-' + d.getFullYear();
            document.getElementById("cur_date1").innerText = date;
        };

        /*=================================*\
				Home Match Selection
		\*=================================*/
		var divChoose = "<label for='choose_match_id'>Choose Match:</label><select id = 'choose_match_id' onchange='update_match_info()'>";
		divChoose = divChoose + "<option value='default'>Select Match</option>";
		for (i = 0; i < matches; i++){
			divChoose = divChoose + "<option value='" + (i + 1) + "'>Match " + (i + 1) + " : "+ team1[i] + " vs " + team2[i] + "</option>";
        }
		divChoose = divChoose + "</select>";
		document.getElementById('choose_round').innerHTML = divChoose;

        /*==================================*\
                Home Top Individual Ranks
        \*===================================*/
        var divran ="<div id='top_player_ranks' style='width:100%;max-width:500px;height:238px;overflow:auto;'><table class='w3-table w3-striped w3-bordered w3-border w3-hoverable w3-white'><tr class='w3-green'><th align='center'>&nbsp;</th><th align='center'>#</th><th align='center'>Player</th><th align='center'>Score</th></tr>";
        for(j=0; j<players ;j++) {
            if (player_ranks_ranks[j] > 5) {
                break;
            }
            divran = divran + "<td><i class='fa fa-user w3-text-red w3-large'></i></td><td align ='center'>";
            if(j!=0 && player_score_ranks[j] == player_score_ranks[j-1])
                divran = divran +"&nbsp";
            else
                divran = divran + player_ranks_ranks[j];
        
            divran = divran + "</td><td>" + player_list_ranks[j]+"</td><td align='center'>" + player_score_ranks[j] + "</td></tr>";
        }
        divran = divran +"</table></div><br><div id='tr_pie_1'></div>";
        document.getElementById('top_player_ranks_group').innerHTML= divran;

        /*==================================*\
                Home Top Team Ranks
        \*==================================*/
        console.log("Team average: " + steam_avg + " " + steam_short);
        console.log("Team ranks: " + steam_list_ranks + " " + steam_score_ranks + " " + steam_ranks_ranks);

        var divteamrank = "<table class='w3-table w3-striped w3-bordered w3-border w3-hoverable w3-white'><tr class='w3-green'><th>&nbsp;</th><th>#</th><th>Team Name</th><th>Avg Score</th></tr>";
        for (let q = 0; q < steam_list_ranks.length; q++) {
            let steam_list_team_ranks = [];
            steam_list_team_ranks[q] = steam[steam_short.indexOf(steam_list_ranks[q])];
            divteamrank = divteamrank + "<td><i class='fa fa-users w3-text-red w3-large'></i></td>";
            divteamrank = divteamrank + "<td align ='center'>" + steam_ranks_ranks[q] + "</td><td>" + steam_list_team_ranks[q]+"</td><td align='center'>" + steam_score_ranks[q] + "</td></tr>";                
        }

        divteamrank = divteamrank +"</table>";
        divteamrank = divteamrank +"<br><div id='tr_pie_2'></div>";

        document.getElementById('top_team_ranks').innerHTML= divteamrank;

        /*=============================*\
                Home Load Operations
        \*=============================*/
        update_match_info();
    </script>
</body>

</html>
